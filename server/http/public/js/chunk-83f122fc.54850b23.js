(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-83f122fc"],{"0043":function(t,n,e){"use strict";var o=e("ab0d"),i=e.n(o);i.a},"066b":function(t,n,e){"use strict";var o=e("7e7a"),i=e.n(o);i.a},"1c53":function(t,n,e){"use strict";const o=e("6fdc");t.exports=(t=>{t=Object.assign({date:new Date,local:!0,showTimeZone:!1,showMilliseconds:!1},t);let n=t.date;t.local&&(n=new Date(n.getTime()-6e4*n.getTimezoneOffset()));let e="";return t.showTimeZone&&(e=" UTC"+(t.local?o(n):"")),t.showMilliseconds&&n.getUTCMilliseconds()>0&&(e=` ${n.getUTCMilliseconds()}ms${e}`),n.toISOString().replace(/T/," ").replace(/\..+/,e)})},"29f4":function(t,n,e){"use strict";var o=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("baidu-map",{staticClass:"bm-view",style:{paddingRight:t.paddingRight},attrs:{center:t.center,zoom:t.zoom,"scroll-wheel-zoom":!0,"continuous-zoom":!0}},[e("bm-map-type",{attrs:{"map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],anchor:"BMAP_ANCHOR_TOP_LEFT"}}),e("bm-scale",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_LEFT"}}),e("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT",showAddressBar:!0,autoLocation:!0}}),e("bm-panorama"),t._l(t.points,function(n,o){return e("bm-marker",{key:o,attrs:{position:{lng:n.lng,lat:n.lat},animation:"BMAP_ANIMATION_DROP",title:n.id,icon:t.icon},on:{click:function(e){return t.handleInfoWindow(n)}}})}),e("bm-info-window",{attrs:{position:{lng:t.pointInfo.lng,lat:t.pointInfo.lat},show:t.show,title:"姓名："+t.pointInfo.name,offset:{width:3,height:-15}},on:{close:t.infoWindowClose,open:t.infoWindowOpen}},[e("span",{staticClass:"point-span"},[e("Row",[e("Col",[t._v("时间："+t._s(t.pointInfo.time))])],1),e("Row",[e("Col",{attrs:{span:"16"}},[t._v("设备号："+t._s(t.pointInfo.id))]),e("Col",{attrs:{span:"8"}},[t._v("定位："+t._s(t.pointInfo.qf))])],1),e("Row",[e("Col",{attrs:{span:"12"}},[t._v("经度："+t._s(t.pointInfo.lng))]),e("Col",{attrs:{span:"12"}},[t._v("纬度："+t._s(t.pointInfo.lat))])],1),e("Row",[e("Col",{attrs:{span:"8"}},[t._v("高度："+t._s(t.pointInfo.alt))]),e("Col",{attrs:{span:"8"}},[t._v("速度："+t._s(t.pointInfo.speed))]),e("Col",{attrs:{span:"8"}},[t._v("方向："+t._s(t.pointInfo.track_true))])],1)],1)])],2)],1)},i=[],s=(e("7f7f"),e("ac6a"),e("7514"),e("b2e5")),a=e.n(s),r=e("c516"),l=e("4653"),c={props:{paddingRight:{type:String,default:"200px"}},data:function(){return{center:{lng:116.404,lat:39.915},zoom:15,points:[],show:!1,pointInfo:"",icon:{url:"http://".concat(document.location.host,"/img/online.png"),size:{width:32,height:32}}}},computed:{},created:function(){var t=this;l["a"].service("position").find({query:{$limit:1,$sort:{time:-1}}}).then(function(n){setTimeout(function(){t.center={lng:n.data[0].lng,lat:n.data[0].lat}},1e3)}).catch(function(n){t.$Message.error({content:"获取位置错误："+n,duration:10,closable:!0})})},mounted:function(){var t=this;r["a"].$on("device-selected",function(n){var e=a.a.find(t.points,{id:n.id});e?(t.center={lng:e.lng,lat:e.lat},t.zoom=19,t.handleInfoWindow(e)):t.$Message.error({content:"此用户无数据",duration:3,closable:!0})}),setInterval(function(){l["a"].service("position").find({query:{$limit:10,$sort:{time:-1}}}).then(function(n){a.a.forEach(n.data,function(n){var e=a.a.find(t.points,{id:n.id});if(e){if(n.time>e.time){t.points=a.a.reject(t.points,{id:n.id});var o=a.a.find(t.$store.state.list,{id:n.id});n.name=o.name,t.points.push(n),t.show&&t.handleInfoWindow(n)}}else{var i=a.a.find(t.$store.state.list,{id:n.id});i&&(n.name=i.name,t.points.push(n))}})}).catch(function(n){t.$Message.error({content:"刷新位置错误："+n,duration:10,closable:!0})})},2e3)},methods:{handleInfoWindow:function(t){this.show=!0,this.pointInfo=a.a.find(this.points,{id:t.id})},infoWindowClose:function(){this.show=!1},infoWindowOpen:function(){this.show=!0}}},d=c,p=(e("066b"),e("2877")),h=Object(p["a"])(d,o,i,!1,null,"290bf8e1",null),f=h.exports,u=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("baidu-map",{staticClass:"bm-view",style:{paddingRight:t.paddingRight},attrs:{center:t.center,zoom:t.zoom,"scroll-wheel-zoom":!0,"continuous-zoom":!0}},[e("bm-map-type",{attrs:{"map-types":["BMAP_NORMAL_MAP","BMAP_HYBRID_MAP"],anchor:"BMAP_ANCHOR_TOP_LEFT"}}),e("bm-scale",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_LEFT"}}),e("bm-geolocation",{attrs:{anchor:"BMAP_ANCHOR_BOTTOM_RIGHT",showAddressBar:!0,autoLocation:!0}}),e("bm-panorama"),t.showLine?e("bm-polyline",{attrs:{path:t.path,"stroke-color":"red","stroke-opacity":1,"stroke-weight":3}}):t._e(),t.showLine?e("bml-lushu",{attrs:{path:t.path,icon:t.iconPerson,play:t.play,speed:t.speed},on:{start:t.start,stop:t.stop,pause:t.pause}}):t._e(),t.showLine?e("bm-marker",{attrs:{position:t.polyStartEnd.start,zIndex:-1,icon:t.iconStart}}):t._e(),t._v("s\n    "),t.showLine?e("bm-marker",{attrs:{position:t.polyStartEnd.end,zIndex:-1,icon:t.iconEnd}}):t._e(),e("bm-info-window",{attrs:{position:{lng:t.pointInfo.lng,lat:t.pointInfo.lat},show:t.show,title:"姓名："+t.pointInfo.name,offset:{width:3,height:-3}},on:{close:t.infoWindowClose,open:t.infoWindowOpen}},[e("span",{staticClass:"point-span"},[e("Row",[e("Col",[t._v("时间："+t._s(t.pointInfo.time))])],1),e("Row",[e("Col",{attrs:{span:"16"}},[t._v("设备号："+t._s(t.pointInfo.id))]),e("Col",{attrs:{span:"8"}},[t._v("定位："+t._s(t.pointInfo.qf))])],1),e("Row",[e("Col",{attrs:{span:"12"}},[t._v("经度："+t._s(t.pointInfo.lng))]),e("Col",{attrs:{span:"12"}},[t._v("纬度："+t._s(t.pointInfo.lat))])],1),e("Row",[e("Col",{attrs:{span:"8"}},[t._v("高度："+t._s(t.pointInfo.alt))]),e("Col",{attrs:{span:"8"}},[t._v("速度："+t._s(t.pointInfo.speed))]),e("Col",{attrs:{span:"8"}},[t._v("方向："+t._s(t.pointInfo.track_true))])],1)],1)])],1)],1)},m=[],g=e("cebc"),w=e("2f62"),y=e("bd0c"),_={props:{paddingRight:{type:String,default:"200px"}},components:{BmlLushu:y["BmlLushu"]},data:function(){return{center:{lng:116.404,lat:39.915},zoom:15,show:!1,showLine:!1,pointInfo:"",polyStartEnd:{start:"",end:""},play:!1,iconPerson:{url:"http://".concat(document.location.host,"/img/person.png"),size:{width:32,height:32},opts:{anchor:{width:16,height:32}}},iconEnd:{url:"http://".concat(document.location.host,"/img/end.png"),size:{width:48,height:48},opts:{anchor:{width:24,height:40}}},iconStart:{url:"http://".concat(document.location.host,"/img/start.png"),size:{width:48,height:48},opts:{anchor:{width:24,height:40}}},speed:2e3}},mounted:function(){var t=this;r["a"].$on("history-clicked",function(n){t.center={lng:n.lng,lat:n.lat},t.zoom=17;var e=a.a.find(t.$store.state.list,{id:n.id});n.name=e.name,t.handleInfoWindow(n)}),r["a"].$on("history-clear",function(){t.show=!1,t.showLine=!1,t.polyStartEnd={}}),r["a"].$on("history-select-done",function(){t.historyList[0]&&(t.center={lng:t.historyList[0].lng,lat:t.historyList[0].lat},t.zoom=17,t.polyStartEnd.start=t.historyList[0],t.polyStartEnd.end=t.historyList[t.historyList.length-1],t.showLine=!0)}),r["a"].$on("history-play",function(){t.start()}),r["a"].$on("history-stop",function(){t.stop()}),r["a"].$on("history-pause",function(){t.pause()})},methods:{handleInfoWindow:function(t){this.show=!0,this.pointInfo=t},infoWindowClose:function(){this.show=!1},infoWindowOpen:function(){this.show=!0},start:function(){this.play=!0},stop:function(){this.play=!1},pause:function(){this.play=!1}},computed:Object(g["a"])({},Object(w["c"])(["historyList"]),{path:function(){var t=[];return a.a.forEach(this.historyList,function(n){n&&t.push({lng:n.lng,lat:n.lat})}),t}})},b=_,v=(e("0043"),Object(p["a"])(b,u,m,!1,null,"1b5f2fe5",null)),I=v.exports;e.d(n,"a",function(){return I}),e.d(n,"b",function(){return f})},3837:function(t,n,e){"use strict";var o=e("3b2f"),i=e.n(o);i.a},"3b2f":function(t,n,e){},"6fdc":function(t,n,e){"use strict";t.exports=(t=>{const n=(t||new Date).getTimezoneOffset(),e=Math.abs(n),o=Math.floor(e/60),i=e%60,s=i>0?":"+("0"+i).slice(-2):"";return(n<0?"+":"-")+o+s})},"7e7a":function(t,n,e){},ab0d:function(t,n,e){},e4bb:function(t,n,e){"use strict";e.r(n);var o=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"layout"},[e("baidu-history",{attrs:{paddingRight:"550px"}}),e("Layout",[e("Sider",{staticClass:"layout-sider",attrs:{width:350}},[e("Card",{attrs:{padding:0,bordered:!1}},[e("p",{attrs:{slot:"title"},slot:"title"},[t._v("轨迹查询")]),e("record")],1)],1)],1)],1)},i=[],s=e("29f4"),a=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("Card",{attrs:{padding:2}},[e("operate")],1),e("Card",{staticClass:"operate",attrs:{padding:2}},[e("point")],1)],1)},r=[],l=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("Table",{attrs:{columns:t.columns,data:t.historyList,size:"small",height:t.tableheight,"highlight-row":""},on:{"on-row-dblclick":t.deviceClick}})],1)},c=[],d=e("cebc"),p=e("2f62"),h=e("c516"),f={data:function(){return{columns:[{title:"序号",key:"no",width:80,align:"center"},{title:"时间",key:"time",align:"center"},{title:"定位",key:"qf",width:60,align:"center"}],tableheight:window.innerHeight-225}},created:function(){var t=this;window.onresize=function(){t.tableheight=window.innerHeight-225},window.onload=function(){t.tableheight=window.innerHeight-225}},computed:Object(d["a"])({},Object(p["c"])(["historyList"])),methods:{deviceClick:function(t){h["a"].$emit("history-clicked",t)}}},u=f,m=(e("f3a1"),e("2877")),g=Object(m["a"])(u,l,c,!1,null,null,null),w=g.exports,y=w,_=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("Form",{attrs:{model:t.formItem,"label-width":60,"label-position":"left"}},[e("FormItem",{staticStyle:{margin:"2px 2px"},attrs:{label:"开始时间"}},[e("DatePicker",{attrs:{size:"small",type:"datetime",placeholder:"选择查询开始时间"},model:{value:t.formItem.datetime.start,callback:function(n){t.$set(t.formItem.datetime,"start",n)},expression:"formItem.datetime.start"}})],1),e("FormItem",{staticStyle:{margin:"2px 2px"},attrs:{label:"结束时间"}},[e("DatePicker",{attrs:{size:"small",type:"datetime",placeholder:"选择查询结束时间"},model:{value:t.formItem.datetime.end,callback:function(n){t.$set(t.formItem.datetime,"end",n)},expression:"formItem.datetime.end"}})],1),e("div",{staticStyle:{margin:"5px 0 5px 0","text-align":"center"}},[e("Button",{attrs:{type:"primary",size:"small",ghost:""},on:{click:t.select}},[t._v("查询")]),e("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",size:"small",ghost:""},on:{click:t.play}},[t._v("播放")]),e("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"success",size:"small",ghost:""},on:{click:t.pause}},[t._v("暂停")]),e("Button",{staticStyle:{"margin-left":"20px"},attrs:{type:"error",size:"small",ghost:""},on:{click:t.clear}},[t._v("清除")])],1)],1)],1)},b=[],v=(e("7514"),e("4653")),I=e("1c53"),C=e.n(I),$={data:function(){return{formItem:{datetime:{start:"",end:""},slider:1},trackData:[]}},mounted:function(){this.$Message.config({top:64,duration:3})},methods:Object(d["a"])({},Object(p["b"])(["setHistoryList","clearHistoryList","setPolylineControlEnd","setPolylineControlStart","setPolylineControl"]),{select:function(){var t=this.$store.state.checked;if(t[0])if(t.length>1)this.$Message.error({content:"暂不支持多个设备查询",closable:!0});else{this.clear();var n=t[0].id,e=36e5,o=new Date(this.formItem.datetime.start),i=new Date(this.formItem.datetime.end),s=o.getTime(),a=i.getTime(),r=Math.ceil((a-s)/e);if(this.setPolylineControlEnd(r),r>24)return void this.$Message.error({content:"暂支持查询24小时数据",closable:!0});for(var l=0;l<r;l++){var c=s+l*e,d=s+(l+1)*e;l==r-1&&(d=a),c=C()({date:new Date(c)}),d=C()({date:new Date(d)}),this.getPosition(n,c,d)}this.$Message.loading({content:"查询轨迹中...",closable:!0})}else this.$Message.error({content:"请选择查询设备",closable:!0})},clear:function(){this.clearHistoryList(),h["a"].$emit("history-clear")},play:function(){h["a"].$emit("history-play")},stop:function(){h["a"].$emit("history-stop")},pause:function(){h["a"].$emit("history-pause")},getPosition:function(t,n,e){var o=this;v["a"].service("position").find({query:{id:t,time:{$lte:e,$gte:n}}}).then(function(t){o.setPolylineControlStart(),t.data[0]&&o.setHistoryList(t.data),o.$store.state.polylineControl.start==o.$store.state.polylineControl.end&&(o.setPolylineControl(),h["a"].$emit("history-select-done"))}).catch(function(t){o.loading=!1,o.$Message.error({content:"查询轨迹失败"+t,closable:!0})})}})},O=$,M=Object(m["a"])(O,_,b,!1,null,"0891e892",null),L=M.exports,k=L,P={components:{Point:y,Operate:k}},T=P,z=Object(m["a"])(T,a,r,!1,null,"df34bb28",null),R=z.exports,A=R,B={components:{BaiduHistory:s["a"],Record:A}},x=B,E=(e("3837"),Object(m["a"])(x,o,i,!1,null,"08a37729",null));n["default"]=E.exports},f3a1:function(t,n,e){"use strict";var o=e("fc04"),i=e.n(o);i.a},fc04:function(t,n,e){}}]);
//# sourceMappingURL=chunk-83f122fc.54850b23.js.map